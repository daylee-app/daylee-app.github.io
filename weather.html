<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daylee Weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="See the weather for your location with Daylee.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" href="/uploads/images/favicon.png" type="image/png">
  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/home.css" rel="stylesheet">
  <style>
    body { font-family: 'Inter', Arial, sans-serif; background: #e0f2fe; margin: 0; padding: 0; }
    .container { max-width: 420px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 16px #2563eb22; padding: 32px 24px 24px 24px; }
    h1 { text-align: center; font-weight: 700; color: #2563eb; margin-bottom: 0.5em; }
    #weather { margin-top: 20px; font-size: 1.08em; }
    .label { font-weight: 600; color: #2563eb; }
    .error { color: #d32f2f; margin-top: 16px; text-align: center; }
    #refresh-btn { margin: 24px auto 0 auto; display: block; background: linear-gradient(90deg,#2563eb 0%,#06b6d4 100%); color: #fff; border: none; border-radius: 8px; padding: 10px 28px; font-size: 1.08em; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px #2563eb22; transition: background 0.2s; }
    #refresh-btn:hover { background: linear-gradient(90deg,#1e40af 0%,#0891b2 100%); }
    .weather-icon { font-size: 2.5em; margin-bottom: 0.2em; display: block; text-align: center; }
    .weather-row { margin-bottom: 0.7em; }
    .weather-title { font-size: 1.15em; font-weight: 600; color: #2563eb; margin-bottom: 0.2em; }
    .weather-detail { color: #22223b; }
    .subtitle { text-align: center; color: #64748b; font-size: 1.05em; margin-bottom: 1.2em; }
    @media (max-width: 500px) {
      .container { padding: 18px 4vw 18px 4vw; }
    }
    a#top-link { color: #2563eb; text-decoration: none; font-weight: 600; font-size: 1.1em; display: block; margin-bottom: 1.2em; }
    a#top-link:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <a href="/dashboard" id="top-link">&lt; Dashboard</a>
  <header>
     <img src="/uploads/images/daylee.png" alt="Daylee Logo" style="width:64px;height:64px;border-radius:16px;box-shadow:0 4px 16px #2563eb22;margin-bottom:0.5rem;animation: popIn 1.2s cubic-bezier(.4,0,.2,1);" />
     <br>
    <span class="logo">daylee</span>
    <div class="subtitle">Your Daylee Dashboard</div>
  </header>
  <div class="container">
    <h1>Weather</h1>
    <div class="subtitle">Get the latest weather for your location</div>
    <div id="weather">
      <div style="text-align:center;color:#64748b;">Loading weather...</div>
    </div>
    <button id="refresh-btn" style="display:none;">Refresh</button>
    <div class="error" id="error"></div>
  </div>
  <script>
    // Uses Open-Meteo API (no key required)
    function fetchWeather(lat, lon) {
      // Determine unit based on location (US, Bahamas, etc use Fahrenheit)
      function prefersFahrenheit(lat, lon) {
        // USA, Bahamas, Cayman, Liberia, Palau, Micronesia, Marshall Islands
        // USA: lat 24-49, lon -125 to -66
        if (lat > 18 && lat < 50 && lon < -50 && lon > -130) return true;
        // Bahamas
        if (lat > 20 && lat < 28 && lon > -80 && lon < -72) return true;
        // Cayman
        if (lat > 18 && lat < 21 && lon > -82 && lon < -79) return true;
        // Liberia
        if (lat > 4 && lat < 9 && lon > -12 && lon < -7) return true;
        // Palau, Micronesia, Marshall Islands (skip for simplicity)
        return false;
      }
      const useF = prefersFahrenheit(lat, lon);
      const tempUnit = useF ? "fahrenheit" : "celsius";
      const windUnit = useF ? "mph" : "kmh";
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,apparent_temperature,precipitation,weathercode,cloudcover,windspeed_10m,winddirection_10m,relativehumidity_2m&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_sum,weathercode&temperature_unit=${tempUnit}&windspeed_unit=${windUnit}&precipitation_unit=mm&timezone=auto`;
      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (!data.current_weather) {
            showError("Weather data not available for your location.");
            return;
          }
          showWeather(data, useF);
        })
        .catch(() => showError("Could not fetch weather data."));
    }

    function getWeatherIcon(code) {
      // Simple emoji icons for weather codes
      if ([0, 1].includes(code)) return "‚òÄÔ∏è";
      if ([2].includes(code)) return "üå§Ô∏è";
      if ([3].includes(code)) return "‚òÅÔ∏è";
      if ([45, 48].includes(code)) return "üå´Ô∏è";
      if ([51, 53, 55, 56, 57, 61, 63, 65, 66, 67, 80, 81, 82].includes(code)) return "üåßÔ∏è";
      if ([71, 73, 75, 77, 85, 86].includes(code)) return "‚ùÑÔ∏è";
      if ([95, 96, 99].includes(code)) return "‚õàÔ∏è";
      return "üå°Ô∏è";
    }

    function showWeather(data, useF) {
      const w = data.current_weather;
      const daily = data.daily;
      const weatherDiv = document.getElementById('weather');
      const weatherCodes = {
        0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
        45: "Fog", 48: "Depositing rime fog", 51: "Light drizzle", 53: "Drizzle", 55: "Dense drizzle",
        56: "Freezing drizzle", 57: "Freezing drizzle", 61: "Slight rain", 63: "Rain", 65: "Heavy rain",
        66: "Freezing rain", 67: "Freezing rain", 71: "Slight snow", 73: "Snow", 75: "Heavy snow",
        77: "Snow grains", 80: "Rain showers", 81: "Rain showers", 82: "Violent rain showers",
        85: "Snow showers", 86: "Heavy snow showers", 95: "Thunderstorm", 96: "Thunderstorm hail", 99: "Thunderstorm hail"
      };
      const tempUnit = useF ? "¬∞F" : "¬∞C";
      const windUnit = useF ? "mph" : "km/h";
      weatherDiv.innerHTML = `
        <div class="weather-icon">${getWeatherIcon(w.weathercode)}</div>
        <div class="weather-row weather-title">${weatherCodes[w.weathercode] || "Unknown"}</div>
        <div class="weather-row weather-detail"><span class="label">Temperature:</span> ${w.temperature}${tempUnit} (feels like ${data.hourly.apparent_temperature[0]}${tempUnit})</div>
        <div class="weather-row weather-detail"><span class="label">Humidity:</span> ${data.hourly.relativehumidity_2m[0]}%</div>
        <div class="weather-row weather-detail"><span class="label">Wind:</span> ${w.windspeed} ${windUnit} (${w.winddirection}¬∞)</div>
        <div class="weather-row weather-detail"><span class="label">Cloud Cover:</span> ${data.hourly.cloudcover[0]}%</div>
        <div class="weather-row weather-detail"><span class="label">Precipitation:</span> ${data.hourly.precipitation[0]} mm</div>
        <div class="weather-row weather-detail"><span class="label">Sunrise:</span> ${daily.sunrise[0].slice(11,16)}</div>
        <div class="weather-row weather-detail"><span class="label">Sunset:</span> ${daily.sunset[0].slice(11,16)}</div>
        <div class="weather-row weather-detail"><span class="label">Today's High:</span> ${daily.temperature_2m_max[0]}${tempUnit}</div>
        <div class="weather-row weather-detail"><span class="label">Today's Low:</span> ${daily.temperature_2m_min[0]}${tempUnit}</div>
        <div class="weather-row weather-detail"><span class="label">Today's Precipitation:</span> ${daily.precipitation_sum[0]} mm</div>
      `;
      document.getElementById('refresh-btn').style.display = 'inline-block';
      document.getElementById('error').textContent = '';
    }

    function showError(msg) {
      document.getElementById('weather').innerHTML = '';
      document.getElementById('error').textContent = msg;
      document.getElementById('refresh-btn').style.display = 'inline-block';
    }

    function getLocationAndWeather() {
      document.getElementById('weather').innerHTML = '<div style="text-align:center;color:#64748b;">Loading weather...</div>';
      document.getElementById('error').textContent = '';
      if (!navigator.geolocation) {
        showError("Geolocation is not supported by your browser.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => fetchWeather(pos.coords.latitude, pos.coords.longitude),
        () => showError("Could not get your location. Please allow location access.")
      );
    }

    document.getElementById('refresh-btn').onclick = getLocationAndWeather;

    // Initial load
    getLocationAndWeather();
  </script>
</body>
</html>
